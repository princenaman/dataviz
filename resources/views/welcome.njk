{% extends 'layouts/layout' %}

{% block css %}
<link rel="stylesheet" href="{{ url('plugins/bootstrap-table/bootstrap-table.css') }}">
<style>
  #platformMixed {
    width: 100%;
    height: 250px;
  }

  #cityMixed {
    width: 100%;
    height: 300px;
  }

  .amcharts-chart-div a {
    display:none !important;
  }

  #locationChart {
    width: 100%;
    height: 300px;
  }

  #weekChart {
    width: 100%;
    height: 300px;
  }

  #starsChart {
    width: 100%;
    height: 200px;
  }

  #ratingChart {
    width: 100%;
    height: 200px;
  }

  .pull-right.search {
      margin: 0;
  }

  .pull-right.search > input {
      margin: 0;
  }
</style>
{% endblock %}

{% block content %}

<div class="container-fluid">

            <!--Section heading-->
            <h4 class="text-left">DataViz Challange</h4>
            <p>Sample dashboard by Naman. </p>
            <hr>
            <br>

            <!--Section: Intro-->
            <section class="section section-intro">

                <!--First row-->
                <div class="row">
                    <!--First column-->
                    <div class="col-md-3 mb-1">
                        <!--Card-->
                        <div class="card card-cascade cascading-admin-card">

                            <!--Card Data-->
                            <div class="admin-up">
                                <i class="fa fa-money blue darken-3"></i>
                                <div class="data">
                                    <p> Total Hotels</p>
                                    <h3> {{ hotelCount }}</h4>
                                </div>
                            </div>
                            <!--/.Card Data-->

                            <!--Card content-->
                            <div class="card-block">
                                {# <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                </div> #}
                                <!--Text-->
                                <p class="card-text">
                                  {{ hotelCount / platformStats.length }} / platform <br>
                                  {{ hotelCount / cityStats.length }} / city
                                </p>
                            </div>
                            <!--/.Card content-->

                        </div>
                        <!--/.Card-->
                    </div>
                    <!--/First column-->

                    <!--Second column-->
                    <div class="col-md-3 mb-1">
                        <!--Card-->
                        <div class="card card-cascade cascading-admin-card">

                            <!--Card Data-->
                            <div class="admin-up">
                                <i class="fa fa-line-chart deep-purple darken-4"></i>
                                <div class="data">
                                    <p> Best Performing</p>
                                </div>
                            </div>
                            <!--/.Card Data-->

                            <!--Card content-->
                            <div class="card-block">
                                <!--Text-->
                                <p class="card-text">
                                  Platform: {{ bestPlatform[0]['platform'] }} : {{ bestPlatform[0]['booking_volume_index'] }} <br>
                                  City: {{ bestCity[0]['city'] }} : {{ bestCity[0]['booking_volume_index'] }}
                                </p>
                            </div>
                            <!--/.Card content-->

                        </div>
                        <!--/.Card-->
                    </div>
                    <!--/Second column-->

                    <!--Third column-->
                    <div class="col-md-3 mb-1">
                        <!--Card-->
                        <div class="card card-cascade cascading-admin-card">

                            <!--Card Data-->
                            <div class="admin-up">
                                <i class="fa fa-pie-chart indigo"></i>
                                <div class="data">
                                    <p> Least Performing</p>
                                </div>
                            </div>
                            <!--/.Card Data-->

                            <!--Card content-->
                            <div class="card-block">
                                <!--Text-->
                                <p class="card-text">
                                  Platform: {{ leastPlatform[0]['platform'] }} : {{ leastPlatform[0]['booking_volume_index'] }} <br>
                                  City: {{ leastCity[0]['city'] }} : {{ leastCity[0]['booking_volume_index'] }}
                                </p>
                            </div>
                            <!--/.Card content-->

                        </div>
                        <!--/.Card-->
                    </div>
                    <!--/Third column-->

                </div>
                <!--/First row-->

            </section>
            <!--/Section: Intro-->

            <!--Section: Main Chart-->
            <section class="section">

                <!--Main row-->
                <div class="row">

                    <div class="col-md-12">
                        <!--Card-->
                        <div class="card card-cascade narrower">

                            <!--Admin panel-->
                            <div class="admin-panel">

                                <!--First row-->
                                <div class="row m-b-0">

                                    <!--First column-->
                                    <div class="col-md-5">

                                        <!--Panel title-->
                                        <div class="view left primary-color">
                                            <h2>Platform Statistics</h2>
                                        </div>
                                        <!--/Panel title-->

                                        <!--Panel data-->
                                        <div class="row card-block pt-3">

                                            <div class="col-md-12">
                                              <!--Cascading element-->
                                              <div class="view right">
                                                  <!--Main chart-->
                                                  <canvas id="radarChartPlatform" height="200px"></canvas>
                                                  <div class="helpers">
                                                    <span class="badge grey">AU Platform</span>
                                                    <span class="badge danger-color">DE Platform</span>
                                                    <span class="badge default-color">US Platform</span>
                                                  </div>
                                              </div>
                                              <!--/Cascading element-->
                                            </div>

                                        </div>
                                        <!--/Panel data-->
                                    </div>
                                    <!--/First column-->

                                    <!--Second column-->
                                    <div class="col-md-7">
                                        <!--Cascading element-->
                                        <div class="view right primary-color">
                                            <!--Main chart-->
                                            <canvas id="sales" height="155px"></canvas>
                                            <div class="helpers">
                                              <span class="badge grey">AU Platform</span>
                                              <span class="badge danger-color">DE Platform</span>
                                              <span class="badge default-color">US Platform</span>
                                            </div>
                                            <span><small style="color: #FFFFFF;">Y-Axis: Booking Volume Index</small></span>
                                        </div>
                                        <!--/Cascading element-->
                                    </div>
                                    <!--/Second column-->

                                    <div class="col-md-12 pl-5 pr-5 mt-1">
                                      <small>
                                        * For radar chart Cities, Hotels, UII & BVI are converted to a relative 100% w.r.t the maximum.
                                        Example: Average booking_volume_index for AU is 4.685, DE is 3.849 and US is 5.078
                                        The maximum here is 5.078 so taking it as 100 the relative values become: AU - 92%, DE - 76%, US - 100%.
                                        Stars are multipled by 20 to make them percent from 100.
                                      </small>
                                    </div>

                                </div>
                                <!--/First row-->

                                <!--Second row-->
                                <div class="row mb-0">
                                    <!--First column-->
                                    <div class="col-md-12">

                                        <!--Panel content-->
                                        <div class="card-block pt-0">

                                            <div class="table-responsive">
                                              <h4 style="margin: 0;">All Platforms</h4>
                                                <!--Table-->
                                                <table class="table">
                                                    <!--Table head-->
                                                    <thead class="thead-inverse">
                                                        <tr>
                                                            <th data-field="platform" >Platform</th>
                                                            <th data-field="cities">Cities</th>
                                                            <th data-field="hotels">Hotels</th>
                                                            <th data-field="stars">Average Stars</th>
                                                            <th data-field="ratings">Average Ratings</th>
                                                            <th data-field="uii">Average UII</th>
                                                            <th data-field="bvi">Average BVI</th>
                                                        </tr>
                                                    </thead>
                                                    <!--/Table head-->

                                                    <!--Table body-->
                                                    <tbody>
                                                      {% for platform in platformStats %}

                                                        {% if loop.index == 1 %}
                                                          <tr class="none-top-border">
                                                              <td>{{ platform.platform }}</td>
                                                              <td>{{ platform.city }}</td>
                                                              <td>{{ platform.hotel }}</td>
                                                              <td>{{ (platform.stars / platform.total) | round(3) }}</td>
                                                              <td>{{ (platform.rating / platform.total) | round(3) }}</td>
                                                              <td>{{ (platform.user_interaction_index / platform.total) | round(3) }}</td>
                                                              <td>{{ (platform.booking_volume_index / platform.total) | round(3) }}</td>
                                                          </tr>
                                                        {% else %}
                                                          <tr>
                                                              <td>{{ platform.platform }}</td>
                                                              <td>{{ platform.city }}</td>
                                                              <td>{{ platform.hotel }}</td>
                                                              <td>{{ (platform.stars / platform.total) | round(3) }}</td>
                                                              <td>{{ (platform.rating / platform.total) | round(3) }}</td>
                                                              <td>{{ (platform.user_interaction_index / platform.total) | round(3) }}</td>
                                                              <td>{{ (platform.booking_volume_index / platform.total) | round(3) }}</td>
                                                          </tr>
                                                        {% endif %}

                                                      {% endfor %}
                                                    </tbody>
                                                    <!--/Table body-->
                                                </table>
                                                <!--/Table-->

                                            </div>

                                        </div>
                                        <!--/.Panel content-->

                                    </div>
                                    <!--/First column-->
                                </div>
                                <!--/Second row-->

                                <!--Thord row-->
                                <div class="row mb-0">
                                    <!--First column-->
                                    <div class="col-md-12">

                                        <!--Panel content-->
                                        <div class="card-block pt-0">
                                            <!--Cascading element-->
                                            <div class="view center">
                                                <!--Main chart-->
                                                <div id="platformMixed"></div>
                                            </div>
                                            <!--/Cascading element-->
                                        </div>
                                        <!--/.Panel content-->

                                    </div>
                                    <!--/First column-->
                                </div>
                                <!--/Third row-->

                            </div>
                            <!--/Admin panel-->

                        </div>
                        <!--/.Card-->
                    </div>

                </div>
                <!--/Main row-->

            </section>
            <!--/Section: Main chart-->

            <!--Section: Cities Chart-->
            <section class="section">

                <!--Main row-->
                <div class="row">

                    <div class="col-md-12">
                        <!--Card-->
                        <div class="card card-cascade narrower">

                            <!--Admin panel-->
                            <div class="admin-panel">

                                <!--Second row-->
                                <div class="row mb-0">
                                    <!--First column-->
                                    <div class="col-md-5">

                                        <!--Panel title-->
                                        <div class="view left primary-color">
                                            <h2>City Statistics</h2>
                                        </div>
                                        <!--/Panel title-->

                                    </div>
                                    <!--/First column-->

                                    <!--Second column-->
                                    <div class="col-md-12">

                                        <!--Panel content-->
                                        <div class="card-block pt-3">

                                            <div class="table-responsive">
                                                <h4 style="margin: 0;">All Cities</h4>
                                                <!--Table-->
                                                <table class="table table-hover">
                                                    <!--Table head-->
                                                    <thead class="thead-inverse">
                                                        <tr class="primary-color">
                                                            <th data-field="city">City</th>
                                                            <th data-field="hotel">Hotels</th>
                                                            <th data-field="stars">Average Stars</th>
                                                            <th data-field="ratings">Average Ratings</th>
                                                            <th data-field="uii">Average UII</th>
                                                            <th data-field="bvi">Average BVI</th>
                                                        </tr>
                                                    </thead>
                                                    <!--/Table head-->

                                                    <!--Table body-->
                                                    <tbody>
                                                      {% for city in cityStats %}

                                                        {% if loop.index == 1 %}
                                                          <tr class="none-top-border">
                                                              <td>{{ city.city }}</td>
                                                              <td>{{ city.hotel }}</td>
                                                              <td>{{ (city.stars / city.total) | round(3) }}</td>
                                                              <td>{{ (city.rating / city.total) | round(3) }}</td>
                                                              <td>{{ (city.user_interaction_index / city.total) | round(3) }}</td>
                                                              <td>{{ (city.booking_volume_index / city.total) | round(3) }}</td>
                                                          </tr>
                                                        {% else %}
                                                          <tr>
                                                              <td>{{ city.city }}</td>
                                                              <td>{{ city.hotel }}</td>
                                                              <td>{{ (city.stars / city.total) | round(3) }}</td>
                                                              <td>{{ (city.rating / city.total) | round(3) }}</td>
                                                              <td>{{ (city.user_interaction_index / city.total) | round(3) }}</td>
                                                              <td>{{ (city.booking_volume_index / city.total) | round(3) }}</td>
                                                          </tr>
                                                        {% endif %}

                                                      {% endfor %}
                                                    </tbody>
                                                    <!--/Table body-->
                                                </table>
                                                <!--/Table-->

                                            </div>

                                        </div>
                                        <!--/.Panel content-->

                                    </div>
                                    <!--/Second column-->

                                    <!--Third column-->
                                    <div class="col-md-12">
                                        <!--Panel content-->
                                        <div class="card-block pt-3">

                                            <div class="table-responsive">
                                              <h4 style="margin: 0;">City Performance Quarterly</h4>
                                                <!--Table-->
                                                <table class="table table-hover">
                                                    <!--Table head-->
                                                    <thead class="thead-inverse">
                                                        <tr class="primary-color">
                                                            <th data-field="city">City</th>
                                                            <th data-field="q1">Quarter 1</th>
                                                            <th data-field="q2">Quarter 2</th>
                                                            <th data-field="q3">Quarter 3</th>
                                                            <th data-field="q4">Quarter 4</th>
                                                        </tr>
                                                    </thead>
                                                    <!--/Table head-->

                                                    <!--Table body-->
                                                    <tbody>
                                                      {% for city in cityStats %}

                                                        {% if loop.index == 1 %}
                                                          <tr class="none-top-border">
                                                              <td>{{ city.city }}</td>
                                                              <td>{{ cityQuarter[loop.index - 1][0] }}</td>
                                                              <td>{{ cityQuarter[loop.index - 1][1] | round(3) }}</td>
                                                              <td>{{ cityQuarter[loop.index - 1][2] | round(3) }}</td>
                                                              <td>{{ cityQuarter[loop.index - 1][3] | round(3) }}</td>
                                                          </tr>
                                                        {% else %}
                                                          <tr>
                                                              <td>{{ city.city }}</td>
                                                              <td>{{ cityQuarter[loop.index - 1][0] }}</td>
                                                              <td>{{ cityQuarter[loop.index - 1][1] | round(3) }}</td>
                                                              <td>{{ cityQuarter[loop.index - 1][2] | round(3) }}</td>
                                                              <td>{{ cityQuarter[loop.index - 1][3] | round(3) }}</td>
                                                          </tr>
                                                        {% endif %}

                                                      {% endfor %}
                                                    </tbody>
                                                    <!--/Table body-->
                                                </table>
                                                <!--/Table-->

                                            </div>

                                        </div>
                                        <!--/.Panel content-->
                                    </div>
                                    <!--/Third column-->

                                </div>
                                <!--/Second row-->

                                <!--Thord row-->
                                <div class="row mb-0">
                                    <!--First column-->
                                    <div class="col-md-12">

                                        <!--Panel content-->
                                        <div class="card-block pt-1">
                                            <!--Cascading element-->
                                            <div class="view center">
                                                <!--Main chart-->
                                                <div id="cityMixed"></div>
                                            </div>
                                            <!--/Cascading element-->
                                        </div>
                                        <!--/.Panel content-->

                                    </div>
                                    <!--/First column-->
                                </div>
                                <!--/Third row-->

                            </div>
                            <!--/Admin panel-->

                        </div>
                        <!--/.Card-->
                    </div>

                </div>
                <!--/Main row-->

            </section>
            <!--/Section: Cities chart-->

            <!--Section: Location Chart-->
            <section class="section">

                <!--Main row-->
                <div class="row">

                    <div class="col-md-12">
                        <!--Card-->
                        <div class="card card-cascade narrower">

                            <!--Admin panel-->
                            <div class="admin-panel">

                                <!--First row-->
                                <div class="row mb-0">

                                    <!--First column-->
                                    <div class="col-md-5">
                                      <!--Panel title-->
                                      <div class="view left primary-color">
                                          <h2>Location Statistics</h2>
                                      </div>
                                      <!--/Panel title-->
                                    </div>
                                    <!--/First column-->

                                    <!--Second column-->
                                    <div class="col-md-12">

                                        <!--Panel content-->
                                        <div class="card-block pt-3">
                                            <!--Cascading element-->
                                            <div class="view center">
                                                <!--Main chart-->
                                                <div id="locationChart"></div>
                                            </div>
                                            <!--/Cascading element-->
                                        </div>
                                        <!--/.Panel content-->

                                    </div>
                                    <!--/Second column-->
                                </div>
                                <!--/First row-->

                            </div>
                            <!--/Admin panel-->

                        </div>
                        <!--/.Card-->
                    </div>

                </div>
                <!--/Main row-->

            </section>
            <!--/Section: Location chart-->

            <!--Section: Week Chart-->
            <section class="section">

                <!--Main row-->
                <div class="row">

                    <div class="col-md-12">
                        <!--Card-->
                        <div class="card card-cascade narrower">

                            <!--Admin panel-->
                            <div class="admin-panel">

                                <!--First row-->
                                <div class="row mb-0">

                                    <!--First column-->
                                    <div class="col-md-5">
                                      <!--Panel title-->
                                      <div class="view left primary-color">
                                          <h2>Weekly Statistics</h2>
                                      </div>
                                      <!--/Panel title-->
                                    </div>
                                    <!--/First column-->

                                    <!--Second column-->
                                    <div class="col-md-12">

                                        <!--Panel content-->
                                        <div class="card-block pt-3">
                                            <!--Cascading element-->
                                            <div class="view center">
                                                <!--Main chart-->
                                                <div id="weekChart"></div>
                                            </div>
                                            <!--/Cascading element-->
                                        </div>
                                        <!--/.Panel content-->

                                    </div>
                                    <!--/Second column-->
                                </div>
                                <!--/First row-->

                            </div>
                            <!--/Admin panel-->

                        </div>
                        <!--/.Card-->
                    </div>

                </div>
                <!--/Main row-->

            </section>
            <!--/Section: Week chart-->

            <!--Section: Charts-->
            <section class="section section-intro">

                <!--Second row-->
                <div class="row m-b-3">

                    <!--First column-->
                    <div class="col-md-4 mb-1">

                        <!--Card-->
                        <div class="card card-cascade narrower">
                            <div class="admin-panel">
                                <!--Card image-->
                                <div class="view">
                                    <div id="starsChart"></div>
                                </div>
                                <!--/Card image-->

                                <!--Card content-->
                                <div class="card-block">

                                    <div class="list-group">
                                        <small class="list-group-item">Stars effect on UII & BVI</small>
                                    </div>

                                </div>
                                <!--/.Card content-->

                            </div>
                        </div>
                        <!--/.Card-->
                    </div>
                    <!--/First column-->

                    <!--Second column-->
                    <div class="col-md-8 mb-1">

                        <!--Card-->
                        <div class="card card-cascade narrower">
                            <div class="admin-panel">
                                <!--Card image-->
                                <div class="view">
                                    <div id="ratingChart"></div>
                                </div>
                                <!--/Card image-->

                                <!--Card content-->
                                <div class="card-block">

                                    <div class="list-group">
                                        <small class="list-group-item">Ratings effect on UII & BVI</small>
                                    </div>

                                </div>
                                <!--/.Card content-->

                            </div>
                        </div>
                        <!--/.Card-->
                    </div>
                    <!--/Second column-->

                </div>
                <!--/Second row-->

            </section>
            <!--/Section: Charts-->

            <!--Section: Hotel Stats-->
            <section class="section section-intro">

                <!--First row-->
                <div class="card">
                  <div class="card-block">
                    <div class="table-responsive">
                      <h4 class="h4-responsive text-center">Hotel Stats</h4>
                      <table class="table" id="hotel-table">
                        <thead class="thead-inverse">
                          <tr>
                            <th data-field = "hotel" data-sortable = "true">Hotel</th>
                            <th data-field = "city" data-sortable = "true">City</th>
                            <th data-field = "stars" data-sortable = "true">Stars</th>
                            <th data-field = "rating" data-sortable = "true">Rating</th>
                            <th data-field = "user_interaction_index" data-sortable = "true">Total UII</th>
                            <th data-field = "booking_volume_index" data-sortable = "true">Total BVI</th>
                            <th data-field = "avg_user_interaction_index" data-sortable = "true">Avg. UII</th>
                            <th data-field = "avg_booking_volume_index" data-sortable = "true">Avg. BVI</th>
                            <th data-field = "location">Location</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for hotel in hotelStats %}
                              <tr>
                                <td>{{ hotel.hotel }}</td>
                                <td>{{ hotel.city }}</td>
                                <td>{{ hotel.stars }}</td>
                                <td>{{ hotel.rating }}</td>
                                <td>{{ hotel.user_interaction_index }}</td>
                                <td>{{ hotel.booking_volume_index }}</td>
                                <td>{{ (hotel.user_interaction_index / hotel.total) | round(3) }}</td>
                                <td>{{ (hotel.booking_volume_index / hotel.total) | round(3) }}</td>
                                <td>{{ hotel.latitude | round(4) }},{{ hotel.longitude | round(4) }}</td>
                              </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <!--/First row-->

            </section>
            <!--/Section: Hotel Stats-->

            <small class="list-group-item">* UII = User Interaction Index and BVI = Booking Volume Index</small>

        </div>

{% endblock %}

{% block js %}

    <script>
        $(function() {

            // Bootstrap Table
            $('.table').bootstrapTable({
                search: true,
                pagination: true,
                showLoading: true,
                trimOnSearch: false
            });

            $(".dropdown-toggle").on('click', function(){
                $(this).parent().addClass(' show')
            })

            $('.table').on('all.bs.table', function (e) {
                $(".dropdown-toggle").on('click', function(){
                    $(this).parent().addClass(' show')
                })
            });

            // Platform Stats Quarterly
            var data = {
                labels: ["Quarter 1", "Quarter 2", "Quarter 3", "Quarter 4"],
                datasets: [{
                    label: "AU Platform",
                    fillColor: "rgba(220,220,220,0.2)",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "rgba(220,220,220,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(0,0,0,.15)",
                    data: {{ auQuarter | dump | safe }},
                    backgroundColor: "#4CAF50"
                },{
                    label: "DE Platform",
                    fillColor: "rgba(247, 70, 74, 0.2)",
                    strokeColor: "#F7464A",
                    pointColor: "#F7464A",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "#F7464A",
                    data: {{ deQuarter | dump | safe }},
                    backgroundColor: "#4CAF50"
                },{
                    label: "US Platform",
                    fillColor: "rgba(70, 191, 189, 0.2)",
                    strokeColor: "#46BFBD",
                    pointColor: "#46BFBD",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "#46BFBD",
                    data: {{ usQuarter | dump | safe }},
                    backgroundColor: "#4CAF50"
                }]
            };

            var option = {
                responsive: true,
                // set font color
                scaleFontColor: "#fff",
                // font family
                defaultFontFamily: "'Roboto', sans-serif",
                // background grid lines color
                scaleGridLineColor: "rgba(255,255,255,.1)",
                // hide vertical lines
                scaleShowVerticalLines: false,
            };

            // Get the context of the canvas element we want to select
            var ctx = document.getElementById("sales").getContext('2d');
            var myLineChart = new Chart(ctx).Line(data, option); //'Line' defines type of the chart.

            // Platform Radar Chart
            var data = {
                labels: ["Cities", "Hotels", "Average Stars", "Average Rating", "UII", "BVI"],
                datasets: [
                    {
                        label: "AU Platform",
                        fillColor: "rgba(220,220,220,0.2)",
                        strokeColor: "rgba(220,220,220,1)",
                        pointColor: "rgba(220,220,220,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(0,0,0,.15)",
                        data: [
                          {{ (platformStats[0]['city'] / maxQuery.city) * 100 }},
                          {{ (platformStats[0]['hotel'] / maxQuery.hotel) * 100 }},
                          {{ ((platformStats[0]['stars'] / platformStats[0]['total']) * 20) | round(0) }},
                          {{ (platformStats[0]['rating'] / platformStats[0]['total']) | round(0) }},
                          {{ ((platformStats[0]['user_interaction_index'] / (platformStats[0]['total'] * maxQuery.user_interaction_index)) * 100) | round(0) }},
                          {{ ((platformStats[0]['booking_volume_index'] / (platformStats[0]['total'] * maxQuery.booking_volume_index)) * 100) | round(0) }}
                        ]
                    },
                    {
                        label: "DE Platform",
                        fillColor: "rgba(247, 70, 74, 0.2)",
                        strokeColor: "#F7464A",
                        pointColor: "#F7464A",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "#F7464A",
                        data: [
                          {{ (platformStats[1]['city'] / maxQuery.city) * 100 }},
                          {{ (platformStats[1]['hotel'] / maxQuery.hotel) * 100 }},
                          {{ ((platformStats[1]['stars'] / platformStats[1]['total']) * 20) | round(0) }},
                          {{ (platformStats[1]['rating'] / platformStats[1]['total']) | round(0) }},
                          {{ ((platformStats[1]['user_interaction_index'] / (platformStats[1]['total'] * maxQuery.user_interaction_index)) * 100) | round(0) }},
                          {{ ((platformStats[1]['booking_volume_index'] / (platformStats[1]['total'] * maxQuery.booking_volume_index)) * 100) | round(0) }}
                        ]
                    },
                    {
                        label: "US Platform",
                        fillColor: "rgba(70, 191, 189, 0.2)",
                        strokeColor: "#46BFBD",
                        pointColor: "#46BFBD",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "#46BFBD",
                        data: [
                          {{ (platformStats[2]['city'] / maxQuery.city) * 100 }},
                          {{ (platformStats[2]['hotel'] / maxQuery.hotel) * 100 }},
                          {{ ((platformStats[2]['stars'] / platformStats[2]['total']) * 20) | round(0) }},
                          {{ (platformStats[2]['rating'] / platformStats[2]['total']) | round(0) }},
                          {{ ((platformStats[2]['user_interaction_index'] / (platformStats[2]['total'] * maxQuery.user_interaction_index)) * 100) | round(0) }},
                          {{ ((platformStats[2]['booking_volume_index'] / (platformStats[2]['total'] * maxQuery.booking_volume_index)) * 100) | round(0) }}
                        ]
                    }
                ]
            };

            // Get the context of the canvas element we want to select
            var ctx = document.getElementById("radarChartPlatform").getContext('2d');
            var myRadarChart = new Chart(ctx).Radar(data, option);

        });
    </script>

    <script src="plugins/amcharts/amcharts.js"></script>
    <script src="plugins/amcharts/serial.js"></script>
    <script src="plugins/amcharts/ammap.js"></script>
    <script src="plugins/amcharts/worldLow.js"></script>
    <script src="plugins/amcharts/continentsLow.js"></script>
    <script src="plugins/amcharts/light.js"></script>
    <script src="{{ url('plugins/bootstrap-table/bootstrap-table.js') }}" charset="utf-8"></script>

    <script>

    // Platform Mixed
    var chart = AmCharts.makeChart("platformMixed", {
      "type": "serial",
      "theme": "light",
      "dataDateFormat": "YYYY-MM-DD",
      "precision": 2,
      "valueAxes": [{
        "id": "v1",
        "title": "Ratings / Stars",
        "position": "left",
        "autoGridCount": false,
        "labelFunction": function(value) {
          return Math.round(value);
        }
      }, {
        "id": "v2",
        "title": "BVI / UUI",
        "gridAlpha": 0,
        "position": "right",
        "autoGridCount": false
      }],
      "graphs": [{
        "id": "g3",
        "valueAxis": "v1",
        "lineColor": "#e1ede9",
        "fillColors": "#e1ede9",
        "fillAlphas": 1,
        "type": "column",
        "title": "Ratings",
        "valueField": "ratings",
        "clustered": false,
        "columnWidth": 0.5,
        "legendValueText": "[[value]]",
        "balloonText": "[[title]]<br /><b style='font-size: 130%'>[[value]]</b>"
      }, {
        "id": "g4",
        "valueAxis": "v1",
        "lineColor": "#62cf73",
        "fillColors": "#62cf73",
        "fillAlphas": 1,
        "type": "column",
        "title": "Stars",
        "valueField": "stars",
        "clustered": false,
        "columnWidth": 0.3,
        "legendValueText": "[[value]]",
        "balloonText": "[[title]]<br /><b style='font-size: 130%'>[[value]]</b>"
      }, {
        "id": "g1",
        "valueAxis": "v2",
        "bullet": "round",
        "bulletBorderAlpha": 1,
        "bulletColor": "#FFFFFF",
        "bulletSize": 5,
        "hideBulletsCount": 50,
        "lineThickness": 2,
        "lineColor": "#20acd4",
        "type": "smoothedLine",
        "title": "Booking Volume Index",
        "useLineColorForBulletBorder": true,
        "valueField": "bvi",
        "balloonText": "[[title]]<br /><b style='font-size: 130%'>[[value]]</b>"
      }, {
        "id": "g2",
        "valueAxis": "v2",
        "bullet": "round",
        "bulletBorderAlpha": 1,
        "bulletColor": "#FFFFFF",
        "bulletSize": 5,
        "hideBulletsCount": 50,
        "lineThickness": 2,
        "lineColor": "#e1ede9",
        "type": "smoothedLine",
        "dashLength": 5,
        "title": "User Interaction Index",
        "useLineColorForBulletBorder": true,
        "valueField": "uui",
        "balloonText": "[[title]]<br /><b style='font-size: 130%'>[[value]]</b>"
      }],
      "categoryField": "platform",
      "categoryAxis": {
        "dashLength": 1,
        "minorGridEnabled": true
      },
      "legend": {
        "useGraphSettings": true,
        "position": "top"
      },
      "balloon": {
        "borderThickness": 1,
        "shadowAlpha": 0
      },
      "dataProvider": [
          {% for platform in platformStats %}
            {
              "platform": "{{ platform.platform }}",
              "bvi": {{ (platform.booking_volume_index / platform.total) | round(3) }},
              "uui": {{ (platform.user_interaction_index / platform.total) | round(3) }},
              "stars": {{ ((platform.stars * 20) / platform.total) | round(3) }},
              "ratings": {{ (platform.rating / platform.total) | round(3) }}
            },
          {% endfor %}
        ]
      });

      // City Mixed
      var chart = AmCharts.makeChart("cityMixed", {
        "type": "serial",
        "theme": "light",
        "dataDateFormat": "YYYY-MM-DD",
        "precision": 2,
        "valueAxes": [{
          "id": "v1",
          "title": "Ratings / Stars",
          "position": "left",
          "autoGridCount": false,
          "labelFunction": function(value) {
            return Math.round(value);
          }
        }, {
          "id": "v2",
          "title": "BVI / UUI",
          "gridAlpha": 0,
          "position": "right",
          "autoGridCount": false
        }],
        "graphs": [{
          "id": "g3",
          "valueAxis": "v1",
          "lineColor": "#e1ede9",
          "fillColors": "#e1ede9",
          "fillAlphas": 1,
          "type": "column",
          "title": "Ratings",
          "valueField": "ratings",
          "clustered": false,
          "columnWidth": 0.5,
          "legendValueText": "[[value]]",
          "balloonText": "[[title]]<br /><b style='font-size: 130%'>[[value]]</b>"
        }, {
          "id": "g4",
          "valueAxis": "v1",
          "lineColor": "#62cf73",
          "fillColors": "#62cf73",
          "fillAlphas": 1,
          "type": "column",
          "title": "Stars",
          "valueField": "stars",
          "clustered": false,
          "columnWidth": 0.3,
          "legendValueText": "[[value]]",
          "balloonText": "[[title]]<br /><b style='font-size: 130%'>[[value]]</b>"
        }, {
          "id": "g1",
          "valueAxis": "v2",
          "bullet": "round",
          "bulletBorderAlpha": 1,
          "bulletColor": "#FFFFFF",
          "bulletSize": 5,
          "hideBulletsCount": 50,
          "lineThickness": 2,
          "lineColor": "#20acd4",
          "type": "smoothedLine",
          "title": "Booking Volume Index",
          "useLineColorForBulletBorder": true,
          "valueField": "bvi",
          "balloonText": "[[title]]<br /><b style='font-size: 130%'>[[value]]</b>"
        }, {
          "id": "g2",
          "valueAxis": "v2",
          "bullet": "round",
          "bulletBorderAlpha": 1,
          "bulletColor": "#FFFFFF",
          "bulletSize": 5,
          "hideBulletsCount": 50,
          "lineThickness": 2,
          "lineColor": "#e1ede9",
          "type": "smoothedLine",
          "dashLength": 5,
          "title": "User Interaction Index",
          "useLineColorForBulletBorder": true,
          "valueField": "uui",
          "balloonText": "[[title]]<br /><b style='font-size: 130%'>[[value]]</b>"
        }],
        "chartScrollbar": {
          "graph": "g1",
          "oppositeAxis": false,
          "offset": 30,
          "scrollbarHeight": 50,
          "backgroundAlpha": 0,
          "selectedBackgroundAlpha": 0.1,
          "selectedBackgroundColor": "#888888",
          "graphFillAlpha": 0,
          "graphLineAlpha": 0.5,
          "selectedGraphFillAlpha": 0,
          "selectedGraphLineAlpha": 1,
          "autoGridCount": true,
          "color": "#AAAAAA"
        },
        "chartCursor": {
          "pan": true,
          "valueLineEnabled": true,
          "valueLineBalloonEnabled": true,
          "cursorAlpha": 0,
          "valueLineAlpha": 0.2
        },
        "categoryField": "platform",
        "categoryAxis": {
          "dashLength": 1,
          "minorGridEnabled": true
        },
        "legend": {
          "useGraphSettings": true,
          "position": "top"
        },
        "balloon": {
          "borderThickness": 1,
          "shadowAlpha": 0
        },
        "dataProvider": [
            {% for city in cityStats %}
              {
                "platform": "{{ city.city }}",
                "bvi": {{ (city.booking_volume_index / city.total) | round(3) }},
                "uui": {{ (city.user_interaction_index / city.total) | round(3) }},
                "stars": {{ ((city.stars * 20) / city.total) | round(3) }},
                "ratings": {{ (city.rating / city.total) | round(3) }}
              },
            {% endfor %}
          ]
        });

      // Location Graph
      /**
       * Define SVG path for target icon
       */
      var targetSVG = "M9,0C4.029,0,0,4.029,0,9s4.029,9,9,9s9-4.029,9-9S13.971,0,9,0z M9,15.93 c-3.83,0-6.93-3.1-6.93-6.93S5.17,2.07,9,2.07s6.93,3.1,6.93,6.93S12.83,15.93,9,15.93 M12.5,9c0,1.933-1.567,3.5-3.5,3.5S5.5,10.933,5.5,9S7.067,5.5,9,5.5 S12.5,7.067,12.5,9z";

      /**
       * Create the map
       */
      var map = AmCharts.makeChart("locationChart", {
        "type": "map",
        "projection": "winkel3",
        "theme": "light",
        "imagesSettings": {
          "rollOverColor": "#089282",
          "rollOverScale": 3,
          "selectedScale": 3,
          "selectedColor": "#089282",
          "color": "#13564e"
        },

        "areasSettings": {
          "unlistedAreasColor": "#15A892",
          "outlineThickness": 0.1
        },

        "zoomControl": {
      		"zoomControlEnabled": true,
          "maxZoomLevel": 100
      	},

        "dataProvider": {
          "map": "worldLow",
          "images": [
            {% for hotel in hotelStats %}
              {
                "svgPath": targetSVG,
                "zoomLevel": 5,
                "scale": 0.5,
                "title": "{{ hotel.hotel }} : {{ hotel.city }} <br> {{ (hotel.stars) }} Star, {{ (hotel.rating) | round(3) }} Rating  <br> Avg. BVI: {{ (hotel.booking_volume_index / hotel.total) | round(3) }}",
                "latitude": {{ hotel.latitude }},
                "longitude": {{ hotel.longitude }}
              },
            {% endfor %}

          ]
        }
      });

      // Week Chart
      var chart = AmCharts.makeChart("weekChart", {
        "type": "serial",
        "addClassNames": true,
        "theme": "light",
        "balloon": {
          "adjustBorderColor": false,
          "horizontalPadding": 10,
          "verticalPadding": 8,
          "color": "#ffffff"
        },

        "dataProvider": [
          {% for week in weekStats %}
            {
              "week": {{ week.week }},
              "uii": {{ week.user_interaction_index }},
              "bvi": {{ week.booking_volume_index }}
            },
          {% endfor %}
        ],
        "valueAxes": [{
          "axisAlpha": 0,
          "position": "left"
        }],
        "startDuration": 1,
        "graphs": [{
          "alphaField": "alpha",
          "balloonText": "<span style='font-size:12px;'>[[title]] in week [[category]]:<br><span style='font-size:20px;'>[[value]]</span> [[additional]]</span>",
          "fillAlphas": 1,
          "title": "UII",
          "type": "column",
          "valueField": "uii",
          "dashLengthField": "dashLengthColumn"
        }, {
          "id": "graph2",
          "balloonText": "<span style='font-size:12px;'>[[title]] in week [[category]]:<br><span style='font-size:20px;'>[[value]]</span> [[additional]]</span>",
          "bullet": "round",
          "lineThickness": 3,
          "bulletSize": 7,
          "bulletBorderAlpha": 1,
          "bulletColor": "#FFFFFF",
          "useLineColorForBulletBorder": true,
          "bulletBorderThickness": 3,
          "fillAlphas": 0,
          "lineAlpha": 1,
          "title": "Booking",
          "valueField": "bvi",
          "dashLengthField": "dashLengthLine"
        }],
        "categoryField": "week",
        "categoryAxis": {
          "gridPosition": "start",
          "axisAlpha": 0,
          "tickLength": 0
        },
        "chartScrollbar": {
          "graph": "graph2",
          "oppositeAxis": false,
          "offset": 30,
          "scrollbarHeight": 50,
          "backgroundAlpha": 0,
          "selectedBackgroundAlpha": 0.1,
          "selectedBackgroundColor": "#888888",
          "graphFillAlpha": 0,
          "graphLineAlpha": 0.5,
          "selectedGraphFillAlpha": 0,
          "selectedGraphLineAlpha": 1,
          "autoGridCount": true,
          "color": "#AAAAAA"
        },
        "chartCursor": {
          "pan": true,
          "valueLineEnabled": true,
          "valueLineBalloonEnabled": true,
          "cursorAlpha": 0,
          "valueLineAlpha": 0.2
        },
      });


      // Stars Chart
      var chart = AmCharts.makeChart("starsChart", {
        "type": "serial",
        "addClassNames": true,
        "theme": "light",
        "balloon": {
          "adjustBorderColor": false,
          "horizontalPadding": 10,
          "verticalPadding": 8,
          "color": "#ffffff"
        },

        "dataProvider": [
          {% for star in starStats %}
            {
              "star": {{ star.stars }},
              "uii": {{ star.user_interaction_index }},
              "bvi": {{ star.booking_volume_index }}
            },
          {% endfor %}
        ],
        "valueAxes": [{
          "axisAlpha": 0,
          "position": "left"
        }],
        "startDuration": 1,
        "graphs": [{
          "alphaField": "alpha",
          "balloonText": "<span style='font-size:12px;'>[[title]] w.r.t [[category]] stars:<br><span style='font-size:20px;'>[[value]]</span></span>",
          "fillAlphas": 1,
          "title": "UII",
          "type": "column",
          "valueField": "uii",
          "dashLengthField": "dashLengthColumn"
        }, {
          "id": "graph2",
          "balloonText": "<span style='font-size:12px;'>[[title]] w.r.t [[category]] stars:<br><span style='font-size:20px;'>[[value]]</span></span>",
          "bullet": "round",
          "lineThickness": 3,
          "bulletSize": 7,
          "bulletBorderAlpha": 1,
          "bulletColor": "#FFFFFF",
          "useLineColorForBulletBorder": true,
          "bulletBorderThickness": 3,
          "fillAlphas": 0,
          "lineAlpha": 1,
          "title": "Booking",
          "valueField": "bvi",
          "dashLengthField": "dashLengthLine"
        }],
        "categoryField": "star",
        "categoryAxis": {
          "gridPosition": "start",
          "axisAlpha": 0,
          "tickLength": 0
        },
      });


      // Ratings Chart
      var chart = AmCharts.makeChart("ratingChart", {
        "type": "serial",
        "addClassNames": true,
        "theme": "light",
        "balloon": {
          "adjustBorderColor": false,
          "horizontalPadding": 10,
          "verticalPadding": 8,
          "color": "#ffffff"
        },

        "dataProvider": [
          {% for rating in ratingStats %}
            {% if rating.rating == null %}
              {% set tempRating = 0 %}
            {% else %}
              {% set tempRating = rating.rating %}
            {% endif %}
            {
              "rating": {{ tempRating }},
              "uii": {{ rating.user_interaction_index }},
              "bvi": {{ rating.booking_volume_index }}
            },
          {% endfor %}
        ],
        "valueAxes": [{
          "axisAlpha": 0,
          "position": "left"
        }],
        "startDuration": 1,
        "graphs": [{
          "alphaField": "alpha",
          "balloonText": "<span style='font-size:12px;'>[[title]] w.r.t [[category]] rating:<br><span style='font-size:20px;'>[[value]]</span></span>",
          "fillAlphas": 1,
          "title": "UII",
          "type": "column",
          "valueField": "uii",
          "dashLengthField": "dashLengthColumn"
        }, {
          "id": "graph2",
          "balloonText": "<span style='font-size:12px;'>[[title]] w.r.t [[category]] rating:<br><span style='font-size:20px;'>[[value]]</span></span>",
          "bullet": "round",
          "lineThickness": 3,
          "bulletSize": 7,
          "bulletBorderAlpha": 1,
          "bulletColor": "#FFFFFF",
          "useLineColorForBulletBorder": true,
          "bulletBorderThickness": 3,
          "fillAlphas": 0,
          "lineAlpha": 1,
          "title": "Booking",
          "valueField": "bvi",
          "dashLengthField": "dashLengthLine"
        }],
        "categoryField": "rating",
        "categoryAxis": {
          "gridPosition": "start",
          "axisAlpha": 0,
          "tickLength": 0
        },
        "chartScrollbar": {
          "graph": "graph2",
          "oppositeAxis": false,
          "offset": 30,
          "scrollbarHeight": 50,
          "backgroundAlpha": 0,
          "selectedBackgroundAlpha": 0.1,
          "selectedBackgroundColor": "#888888",
          "graphFillAlpha": 0,
          "graphLineAlpha": 0.5,
          "selectedGraphFillAlpha": 0,
          "selectedGraphLineAlpha": 1,
          "autoGridCount": true,
          "color": "#AAAAAA"
        },
        "chartCursor": {
          "pan": true,
          "valueLineEnabled": true,
          "valueLineBalloonEnabled": true,
          "cursorAlpha": 0,
          "valueLineAlpha": 0.2
        },
      });

    </script>

{% endblock %}
